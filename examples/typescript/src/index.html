<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Sitck'Em Electronics Board Firmware Updater</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@4.19.0/css/xterm.css">
        <link
            href="https://fonts.googleapis.com/css?family=Orbitron"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link rel="icon" href="../assets/favicon.ico" />
        <style>
            #steps {
                margin: 20px 0;
            }
            
            .step-display {
                position: relative;
                padding: 15px;
                background-color: #f8f9fa;
                border-radius: 5px;
                border: 1px solid #dee2e6;
                text-align: left;
                min-height: 170px; /* Consistent height for all steps */
                display: flex;
                align-items: flex-start;
            }
            
            .step-content {
                font-size: 16px;
                font-weight: 500;
                color: #495057;
                flex: 1;
                padding-right: 100px; /* Space for navigation arrows */
                white-space: pre-line; /* Preserves newlines and wraps text */
            }
            
            .step-image {
                max-width: 100%;
                height: 200px;
                margin: 10px 0;
                border: 1px solid #dee2e6;
                border-radius: 5px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .step-navigation-arrows {
                position: absolute;
                bottom: 15px;
                right: 15px;
                display: flex;
                gap: 10px;
                z-index: 10;
            }
            
            #prevStep, #nextStep {
                width: 45px;
                height: 45px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                font-weight: bold;
                border-radius: 50%;
                box-shadow: 0 2px 8px rgba(0,0,0,0.15);
                border: 2px solid #6c757d;
            }
            
            #prevStep:hover, #nextStep:hover {
                background-color: #5a6268;
                border-color: #545b62;
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            }
            
            #prevStep:disabled, #nextStep:disabled {
                opacity: 0.4;
                cursor: not-allowed;
                transform: none;
                box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            }
            
            #prevStep:disabled:hover, #nextStep:disabled:hover {
                background-color: #6c757d;
                border-color: #6c757d;
            }
            
            .control-terminal-container {
                display: flex;
                gap: 20px;
                margin-top: 20px;
            }
            
            .controls-section {
                flex: 1;
                min-width: 300px;
            }
            
            .terminal-section {
                flex: 1;
                min-width: 400px;
            }
        </style>
         <script src="https://cdn.jsdelivr.net/npm/xterm@4.19.0/lib/xterm.min.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.js"></script>
         <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
         <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    </head>
    <body>
        </div>
        <header style="background-color: #f8f9fa; padding: 10px; border-bottom: 2px solid #dee2e6; margin-bottom: 5px;">
            <div class="container">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <img src="STICKEM-LOGO.png" alt="Stick'Em Logo" style="height: 60px; width: auto;">
                    <h1 style="margin: 0; font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 28px; color: #495057;">Stick'Em Electronics Board Firmware Updater</h1>
                </div>
            </div>
        </header>
        <div class="container" id="main">
            <hr/>
            <div id="steps">
                <div class="step-display">
                    <span id="stepContent" class="step-content">Step 1: Connect the ESP Board to your laptop using a data cable.</span>
                    <!-- Step navigation arrows at bottom right of step content -->
                    <div class="step-navigation-arrows">
                        <button id="prevStep" class="btn btn-secondary btn-sm">←</button>
                        <button id="nextStep" class="btn btn-secondary btn-sm">→</button>
                    </div>
                </div>
            </div>
            <div class="control-terminal-container">
                <div class="controls-section">
                    <div id="program">
                        <label for="baudrates" id="lblBaudrate">Baudrate:</label>
                        <label style="display:none" id="lblConnTo">Connected to device: </label>
                        <select name="baudrates" id="baudrates">
                            <!-- <option value="921600">921600</option> -->
                            <option value="460800">460800</option>
                            <option value="230400">230400</option>
                            <option value="115200">115200</option>
                        </select>

                        <div id="boardNameSection" style="display: none;">
                            <label for="boardName">Board Name:</label>
                            <input type="text" id="boardName" placeholder="Enter board name" style="margin-right: 10px;" />
                            <input class="btn btn-success btn-sm" type="button" id="writeBoardNameButton" value="Flash & Write Board Name" />
                        </div>

                        <input class="btn btn-info btn-sm" type="button" id="connectButton" value="Auto Connect" />
                        <input class="btn btn-secondary btn-sm" type="button" id="manualConnectButton" value="Manual Connect" />
                        <input class="btn btn-danger btn-sm" type="button" id="disconnectButton" value="Disconnect" />
                        <br>

                        <div class="alert alert-danger alert-dismissible" id="alertDiv" style="display:none; margin-top:10px">
                            <a href="#" class="close" aria-label="close" onclick="$('.alert').hide()">&times;</a>
                            <span id="alertmsg"></span>
                        </div>
                    </div>
                </div>
                <div class="terminal-section">
                    <h3> Terminal </h3>
                    <div id="terminal"></div>
                </div>
            </div>
        </div>
        <script src="index.ts" type="module"></script>
        <script>
            // Safari 3.0+ "[object HTMLElementConstructor]"
            //var isSafari = /constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === "[object SafariRemoteNotification]"; })(!window['safari'] || (typeof safari !== 'undefined' && window['safari'].pushNotification));

            //if(isSafari)
            //{
            //   document.getElementById("safariErr").style.display = "inline";
            //   document.getElementById("main").style.display = "none";
            //}

            // Check Web Serial API support
            if (!('serial' in navigator)) {
                var alertDiv = document.getElementById("alertDiv");
                var alertMsg = document.getElementById("alertmsg");
                if (alertDiv && alertMsg) {
                    alertMsg.textContent = "Web Serial API is not supported in this browser. Please use Chrome, Edge, or another Chromium-based browser.";
                    alertDiv.style.display = "block";
                }
                
                var connectButton = document.getElementById("connectButton");
                if (connectButton) {
                    connectButton.disabled = true;
                    connectButton.title = "Web Serial API not supported";
                }
            }
        </script>
    </body>
</html>
